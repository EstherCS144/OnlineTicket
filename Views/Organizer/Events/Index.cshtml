@model IEnumerable<OnlineTicket.Models.Event>

<div class="max-w-6xl mx-auto p-6">

    <!-- Heading Section -->
    <div class="mb-6 text-center">
        <h1 class="text-3xl font-bold text-indigo-600 mb-2 hover:text-indigo-800 transition duration-300">
            Your Events
        </h1>
        <p class="text-gray-500 text-md hover:text-gray-700 transition duration-300">
            Manage your events and ticket types efficiently. Use the filters to quickly find what you need.
        </p>
    </div>

    <!-- TempData Messages -->
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="bg-green-100 text-green-800 p-3 rounded mb-4 flex justify-between items-center shadow">
            <span>@TempData["SuccessMessage"]</span>
            <button type="button" class="ml-4 font-bold text-lg" onclick="this.parentElement.style.display='none'">×</button>
        </div>
    }
    @if (TempData["ErrorMessage"] != null)
    {
        <div class="bg-red-100 text-red-800 p-3 rounded mb-4 flex justify-between items-center shadow">
            <span>@TempData["ErrorMessage"]</span>
            <button type="button" class="ml-4 font-bold text-lg" onclick="this.parentElement.style.display='none'">×</button>
        </div>
    }

    <!-- Filter Form -->
    <form id="filterForm" method="get" class="flex flex-wrap gap-4 mb-6 items-end">
        <div>
            <input type="text" name="search" value="@ViewBag.Search" placeholder="Search by title"
                   class="form-input px-3 py-2 rounded border w-full sm:w-64" />
        </div>

        <div>
            <select name="CategoryId" asp-items="ViewBag.CategoryList" class="form-select px-3 py-2 rounded border w-full sm:w-48">
                <option value="">All Categories</option>
            </select>
        </div>

        <div>
            <select name="VenueId" asp-items="ViewBag.VenueList" class="form-select px-3 py-2 rounded border w-full sm:w-48">
                <option value="">All Venues</option>
            </select>
        </div>

        <div>
            <select name="Status" asp-items="ViewBag.StatusList" class="form-select px-3 py-2 rounded border w-full sm:w-48"></select>
        </div>

        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition">Filter</button>
        <button type="button" onclick="clearFilters()" class="px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400 transition">
            Clear
        </button>
    </form>

    <!-- Event Table -->
    <table class="min-w-full border rounded overflow-hidden shadow-sm">
        <thead class="bg-gray-100">
            <tr>
                <th class="px-4 py-2 text-left">Title</th>
                <th class="px-4 py-2 text-left">Category</th>
                <th class="px-4 py-2 text-left">Venue</th>
                <th class="px-4 py-2 text-left">Event Date</th>
                <th class="px-4 py-2 text-left">Tickets Sold / Available</th>
                <th class="px-4 py-2 text-left">Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var ev in Model)
            {
                <tr class="border-b hover:bg-gray-50 transition">
                    <td class="px-4 py-2">@ev.Title</td>
                    <td class="px-4 py-2">@ev.Category.Name</td>
                    <td class="px-4 py-2">@ev.Venue.Name</td>
                    <td class="px-4 py-2">@ev.EventDate.ToString("yyyy-MM-dd")</td>
                    <td class="px-4 py-2">@(ev.Tickets?.Count ?? 0) / @(ev.TotalSeats)</td>
                    <td class="px-4 py-2 flex gap-2">
                        <a href="@Url.Action("EditEvent", "Organizer", new { id = ev.EventId })"
                           class="px-3 py-1 bg-yellow-400 text-white rounded hover:bg-yellow-500 transition">Edit</a>
                        <form asp-action="DeleteEventConfirmed" asp-controller="Organizer" method="post" onsubmit="return confirm('Are you sure you want to delete this event?');">
                            <input type="hidden" name="id" value="@ev.EventId" />
                            @Html.AntiForgeryToken()
                            <button type="submit" class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition">Delete</button>
                        </form>
                        <a href="@Url.Action("AddTicketTypes", "Organizer", new { eventId = ev.EventId })"
                           class="px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 transition">Tickets</a>
                    </td>
                </tr>
            }
        </tbody>
    </table>

    <!-- Pagination -->
    <div class="mt-4 flex justify-center gap-2">
        @for (int i = 1; i <= ViewBag.TotalPages; i++)
        {
            <a href="?page=@i&search=@ViewBag.Search&categoryId=@ViewBag.CategoryId&venueId=@ViewBag.VenueId&status=@ViewBag.Status"
               class="px-3 py-1 rounded @(i == ViewBag.Page ? "bg-blue-600 text-white" : "bg-gray-200")">
                @i
            </a>
        }
    </div>

    <!-- Back to Dashboard -->
    <div class="mt-6 text-center">
        <h2 class="text-xl font-semibold text-gray-700 mb-2">Need to return to your main dashboard?</h2>
        <p class="text-gray-500 mb-3">Click below to go back and manage other aspects of your organizer account.</p>
        <a asp-action="Dashboard" asp-controller="Organizer"
           class="inline-flex items-center px-4 py-2 border rounded text-gray-700 hover:bg-gray-100 transition">
            <i class="fa-solid fa-arrow-left mr-2"></i> Back to Dashboard
        </a>
    </div>

</div>

@section Scripts {
    <script>
        function clearFilters() {
            const form = document.getElementById('filterForm');
            if (!form) return;
            form.querySelectorAll('input, select').forEach(el => {
                if (el.type === 'text') el.value = '';
                else if (el.tagName === 'SELECT') el.selectedIndex = 0;
            });
            form.submit(); // form submits to current page without redirecting
        }
    </script>
}
